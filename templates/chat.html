<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Chat con HEO</title>
  <link rel="stylesheet" href="/static/css/chat.css">
</head>
<body>
  <header class="top">
    <a href="/" class="back">‚Üê Volver</a>
    <h1>Chat con HEO</h1>
  </header>

  <main id="feed" class="feed"></main>

  <form id="form" class="bar">
    <input id="msg" autocomplete="off" placeholder="Escr√≠bele a HEO‚Ä¶">
    <button>Enviar</button>
  </form>

  <script>
    const feed = document.getElementById('feed');
    const form = document.getElementById('form');
    const msg = document.getElementById('msg');

    function bubble(text, mine=false){
      const el = document.createElement('div');
      el.className = 'bubble ' + (mine?'mine':'heo');
      el.textContent = text;
      feed.appendChild(el);
      feed.scrollTop = feed.scrollHeight;
    }

    bubble("Hola, soy HEO ü§ñ. ¬øTe antoja algo con pan batido hoy?");

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const text = msg.value.trim();
      if(!text) return;
      bubble(text, true);
      msg.value = '';
      const r = await fetch('/api/chat', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({message:text})
      });
      const data = await r.json();
      bubble(data.reply || '‚Ä¶');
    });
  </script>
</body>
</html>
